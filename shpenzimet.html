<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Shpenzimet • Normal Holding</title>
  <meta name="theme-color" content="#6a5ae0">
  <style>
    :root{
      --bg:#f6f7fb;--card:#fff;--text:#1f2340;--muted:#7c82a1;
      --primary:#6a5ae0;--primary2:#7f6ff0;--danger:#ff5959;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --safe-top:env(safe-area-inset-top,0px);
      --safe-bottom:env(safe-area-inset-bottom,0px);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-rounded,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .wrap{display:flex;flex-direction:column;min-height:100vh;padding-bottom:calc(78px + var(--safe-bottom))}
    header{background:linear-gradient(135deg,var(--primary),var(--primary2));color:#fff;border-bottom-left-radius:28px;border-bottom-right-radius:28px;padding:calc(16px + var(--safe-top)) 18px 16px;box-shadow:0 10px 26px rgba(106,90,224,.28)}
    header .top{display:flex;justify-content:space-between;align-items:center}
    header .title{font-size:24px;font-weight:900;display:flex;gap:10px;margin-top:8px}
    header .big{font-size:38px;font-weight:900;margin-top:10px}
    .stats{display:flex;gap:12px;padding:12px 14px;transform:translateY(-18px)}
    .card{flex:1;background:var(--card);border-radius:16px;padding:12px;box-shadow:var(--shadow)}
    .muted{color:var(--muted)}
    main{padding:0 14px 24px}
    .list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .item{display:flex;gap:12px;align-items:center;background:#fff;border-radius:14px;box-shadow:var(--shadow);padding:12px}
    .ic{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:var(--primary);color:#fff}
    .meta{flex:1}.meta .t{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.meta .s{font-size:12px;color:var(--muted)}
    .amt{font-weight:800}
    .del{border:none;background:transparent;color:var(--danger);font-size:20px;cursor:pointer}
    .row{display:flex;gap:10px}
    label{font-size:13px;color:var(--muted)}
    input,select{width:100%;padding:12px;border:1px solid #e6e7ee;border-radius:12px;font-size:16px;background:#fff;-webkit-appearance:none}
    .actions{display:flex;gap:10px;margin-top:10px}
    .btnP{flex:1;background:var(--primary);color:#fff;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    .btnS{flex:1;background:#f0f1f8;color:#1f2340;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    .btnMini{background:#eef0fb;border:none;padding:8px 10px;border-radius:10px;font-weight:800;cursor:pointer}
    .btnMini.ok{background:#e9f8ef;color:#137a3a}
    .chip{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#eef0fb;color:#3c3f68}
    .chip.ok{background:#e9f8ef;color:#137a3a}
    h3.sec{margin:0 0 8px}

    nav.nav{position:fixed;left:0;right:0;bottom:0;height:calc(70px + var(--safe-bottom));padding:0 10px var(--safe-bottom);background:#fff;display:grid;grid-template-columns:1fr 1fr auto 1fr 1fr;align-items:center;box-shadow:0 -8px 28px rgba(0,0,0,.06);border-top-left-radius:16px;border-top-right-radius:16px}
    .btn{justify-self:center;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;color:var(--muted);text-decoration:none}
    .btn.active{color:var(--primary);font-weight:800}
    .fab{justify-self:center;transform:translateY(-20px);width:60px;height:60px;background:var(--primary);border-radius:999px;color:#fff;font-size:28px;display:grid;place-items:center;border:none;box-shadow:0 12px 28px rgba(106,90,224,.45);cursor:pointer}
    .tab{display:none}.tab.active{display:block}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.28);display:none;place-items:end;padding:14px}
    .modal.on{display:grid}
    .sheet{background:#fff;border-radius:22px;padding:14px 14px 18px;width:100%;box-shadow:0 -10px 26px rgba(0,0,0,.14)}

    .gate{position:fixed;inset:0;display:none;place-items:center;background:var(--bg);padding:18px;z-index:1000}
    .panel{background:#fff;width:min(520px,92vw);border-radius:20px;padding:18px;box-shadow:var(--shadow)}
    .tabs{display:flex;gap:6px;margin-bottom:10px}
    .tabs button{flex:1;border:none;padding:10px;border-radius:10px;background:#f1f2fa;cursor:pointer}
    .tabs button.active{background:var(--primary);color:#fff;font-weight:700}

    .seg{background:#f0f1f8;border-radius:12px;padding:4px;display:grid;gap:4px}
    .seg.two{grid-template-columns:1fr 1fr}
    .seg.three{grid-template-columns:1fr 1fr 1fr}
    .seg button{border:none;padding:10px;border-radius:10px;background:transparent;cursor:pointer;font-weight:700;color:#555}
    .seg button.active{background:var(--primary);color:#fff}

    @media(min-width:720px){.wrap{max-width:520px;margin:0 auto}}
  </style>
</head>
<body>
<!-- ===== HYRJE / REGJISTRIM ===== -->
<div id="gate" class="gate">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:900;font-size:20px">Normal Holding</div>
      <div class="muted">Shpenzimet • Cloud</div>
    </div>
    <div class="tabs">
      <button id="tabLoginBtn" class="active" onclick="swapAuth('login')">Hyrje</button>
      <button id="tabRegBtn" onclick="swapAuth('reg')">Regjistrohu</button>
    </div>
    <div id="authLogin">
      <label>Email</label>
      <input id="loginEmail" placeholder="darti@example.com" autocomplete="username">
      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Fjalëkalimi</label><input id="loginPass" type="password" autocomplete="current-password" placeholder="••••••••"></div>
      </div>
      <div class="actions"><button class="btnP" onclick="login()">Hyr</button></div>
      <div id="authMsg" class="muted" style="margin-top:6px"></div>
    </div>
    <div id="authReg" style="display:none">
      <label>Email</label>
      <input id="regEmail" placeholder="darti@example.com" autocomplete="username">
      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Fjalëkalimi</label><input id="regPass" type="password" autocomplete="new-password" placeholder="min. 6"></div>
      </div>
      <div class="actions"><button class="btnS" onclick="swapAuth('login')">Kthehu</button><button class="btnP" onclick="registerUser()">Krijo llogari</button></div>
      <div id="regMsg" class="muted" style="margin-top:6px"></div>
    </div>
  </div>
</div>

<!-- ===== APLIKACIONI ===== -->
<div class="wrap" id="app" style="display:none">
  <header>
    <div class="top">
      <div style="font-weight:800">Normal Holding</div>
      <div class="muted" id="who">@përdoruesi</div>
    </div>
    <div class="title"><span id="hdrIcon">💰</span><span id="hdrText">Bilanci</span></div>
    <div class="big"><span id="hdrTotal">0</span> L</div>
    <div class="muted" id="hdrSub">Gjendja − Shpenzimet (totale)</div>
  </header>

  <div class="stats">
    <div class="card"><div class="muted" id="s1name">📊 Totale</div><div style="font-weight:800;font-size:20px"><span id="stat1">0</span> L</div></div>
    <div class="card"><div class="muted" id="s2name">📅 Sot</div><div style="font-weight:800;font-size:20px"><span id="stat2">0</span> L</div></div>
    <div class="card"><div class="muted" id="s3name">🗓️ Muaj</div><div style="font-weight:800;font-size:20px"><span id="stat3">0</span> L</div></div>
  </div>

  <main>
    <section id="tab-home" class="tab active">
      <h3 class="sec">🕒 Të fundit</h3>
      <div id="recentList" class="list"></div>
      <div id="emptyHome" class="muted" style="text-align:center;margin-top:16px">Asnjë shpenzim deri tani.</div>
    </section>

    <section id="tab-list" class="tab">
      <h3 class="sec">📚 Lista</h3>
      <div class="row" style="margin:8px 0 10px">
        <input id="q" placeholder="Kërko..." oninput="drawAll()">
        <select id="fCat" onchange="drawAll()"><option value="">Të gjitha</option></select>
      </div>
      <div id="allList" class="list"></div>
    </section>

    <section id="tab-debts" class="tab">
      <h3 class="sec">💳 Borxhet</h3>
      <div class="row" style="margin:8px 0 10px">
        <input id="dq" placeholder="Kërko borxhe..." oninput="drawDebts()">
      </div>
      <div class="seg three" id="dSegFilter" style="margin-bottom:8px">
        <button type="button" class="active" data-val="">Të gjitha</button>
        <button type="button" data-val="borrow">Mora hua</button>
        <button type="button" data-val="lend">Dhash hua</button>
      </div>
      <div id="debtList" class="list"></div>
      <div id="emptyDebts" class="muted" style="text-align:center;margin-top:16px">Asnjë borxh deri tani.</div>
    </section>

    <section id="tab-settings" class="tab">
      <h3 class="sec">⚙️ Cilësime</h3>
      <div class="item">
        <div class="ic">👤</div>
        <div class="meta"><div class="t">Përdoruesi</div><div class="s muted" id="userInfo">—</div></div>
        <button class="del" style="color:#555" onclick="logout()">🚪</button>
      </div>

      <div class="card" style="margin-top:12px">
        <h4 style="margin:0 0 8px">💼 Gjendja (L)</h4>
        <div class="row"><input id="balInput" type="number" step="0.01" inputmode="decimal" placeholder="p.sh. 50000"></div>
        <div class="actions"><button class="btnP" onclick="saveBalance()">Ruaj gjendjen</button></div>
        <div class="muted" id="balMsg" style="margin-top:6px;font-size:12px">Nëse

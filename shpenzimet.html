<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Normal Holding â€¢ Shpenzimet</title>
<meta name="theme-color" content="#0d1117">
<style>
/* ===== Tema (GitHub dark + yeÅŸil vurgu) ===== */
:root{
  --bg:#0d1117; --card:#161b22; --card2:#0f141a;
  --border:#30363d; --muted:#8b949e; --text:#c9d1d9;
  --primary:#2ea043; --primary2:#238636; --blue:#1f6feb; --danger:#f85149;
  --shadow:0 10px 28px rgba(0,0,0,.35);
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
  --nav-h:86px;
}
*{box-sizing:border-box}
html,body{height:100%;background:var(--bg);color:var(--text);overflow-x:hidden;overscroll-behavior:none}
body{margin:0;font-family:ui-rounded,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}

/* ===== KapsayÄ±cÄ± ===== */
.wrap{min-height:100vh;display:flex;flex-direction:column;padding-bottom:calc(var(--nav-h)+var(--safe-bottom))}
header{
  background:linear-gradient(135deg,var(--primary2),var(--primary));
  color:#fff;border-bottom-left-radius:18px;border-bottom-right-radius:18px;
  padding:calc(8px + var(--safe-top)) 14px 10px;box-shadow:0 12px 28px rgba(35,134,54,.35)
}
header .top{display:flex;justify-content:space-between;align-items:center}
header .title{display:flex;gap:8px;margin-top:6px;font-weight:900;font-size:clamp(16px,4vw,20px)}
header .big{margin-top:6px;font-weight:900;font-size:clamp(22px,6vw,30px)}
header .muted{opacity:.85}
.stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:8px 12px;transform:translateY(-10px)}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
.card .v{font-weight:800;color:#e6edf3;font-size:clamp(16px,4.2vw,18px)}
main{padding:0 12px 18px}
h3.sec{margin:6px 0 8px}

/* ===== Liste satÄ±rÄ± ===== */
.list{display:flex;flex-direction:column;gap:10px}
.item{display:flex;gap:10px;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
.ic{width:48px;height:48px;border-radius:50%;display:grid;place-items:center;font-size:24px;color:#0d1117;
  background:radial-gradient(circle at 30% 30%,#e6ffec 0%,#c7eed6 45%,#2ea043 100%);
  box-shadow:inset 0 1px 4px rgba(0,0,0,.55),0 6px 14px rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.06)}
.meta{flex:1;min-width:0}
.meta .t{font-weight:800;color:#e6edf3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta .s{font-size:12px;color:var(--muted)}
.amt{font-weight:900;color:#e6edf3}
.btnMini{background:#21262d;border:1px solid var(--border);padding:8px 10px;border-radius:10px;font-weight:800;color:#e6edf3;cursor:pointer}
.del{border:none;background:transparent;color:var(--danger);font-size:20px;cursor:pointer}

/* ===== Form elemanlarÄ± ===== */
label{font-size:13px;color:var(--muted)}
input,select{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card);color:var(--text);font-size:16px}
.row{display:flex;gap:10px}
.actions{display:flex;gap:10px;margin-top:10px}
.btnP{flex:1;background:linear-gradient(180deg,var(--primary),var(--primary2));color:#fff;border:1px solid #2ea043;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
.btnS{flex:1;background:#21262d;color:#e6edf3;border:1px solid var(--border);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
.chip{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#1f6feb;color:#fff}

/* ===== Alt Nav ===== */
nav.nav{
  position:fixed;left:0;right:0;bottom:0;z-index:2000;transform:translateZ(0);
  height:calc(var(--nav-h) + var(--safe-bottom));padding:8px 12px calc(8px + var(--safe-bottom));
  background:var(--card);border-top:1px solid var(--border);border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -10px 28px rgba(0,0,0,.35);
  display:grid;grid-template-columns:1fr 1fr 100px 1fr 1fr;align-items:center;gap:0
}
.btn{justify-self:center;display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--muted);text-decoration:none}
.btn:nth-of-type(1){grid-column:1}.btn:nth-of-type(2){grid-column:2}.btn:nth-of-type(3){grid-column:4}.btn:nth-of-type(4){grid-column:5}
.btn .ico{width:44px;height:44px;border-radius:50%;display:grid;place-items:center;font-size:24px;color:#0d1117;
  background:radial-gradient(circle at 30% 30%,#e6ffec 0%,#c7eed6 45%,#2ea043 100%);
  box-shadow:inset 0 1px 3px rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.06)}
.btn.active{color:#79c0ff}
.btn.active .ico{background:radial-gradient(circle at 30% 30%,#cfe7ff 0%,#9dd2ff 45%,#1f6feb 100%)}
.nav .fab{
  position:absolute;left:50%;transform:translateX(-50%);top:-22px;width:58px;height:58px;border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#e6ffec 0%,#c7eed6 45%,#2ea043 100%);color:#0d1117;font-size:30px;
  display:grid;place-items:center;border:1px solid rgba(255,255,255,.06);box-shadow:0 14px 26px rgba(0,0,0,.5),inset 0 1px 4px rgba(0,0,0,.55);cursor:pointer;pointer-events:auto;z-index:2100
}
@supports (-webkit-touch-callout:none){.nav .fab{top:-24px}}

/* Sekmeler */
.tab{display:none}.tab.active{display:block}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;place-items:end;padding:14px;z-index:3000}
.modal.on{display:grid}
.sheet{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px 14px 18px;width:100%;box-shadow:0 -12px 30px rgba(0,0,0,.5)}

/* Emoji picker */
.picker-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;max-height:45vh;overflow:auto;margin-top:8px}
.picker-grid button{border:1px solid var(--border);background:#21262d;border-radius:10px;width:44px;height:44px;font-size:22px;cursor:pointer}

/* Ayarlarda baÅŸlÄ±ÄŸÄ±n sade olmasÄ± iÃ§in */
.header-simple .stats{display:none}
.header-simple .big{display:none}

/* Responsive geniÅŸ ekran */
@media(min-width:720px){.wrap{max-width:520px;margin:0 auto}}
</style>
</head>
<body>

<!-- ===== GÄ°RÄ°Å ===== -->
<div id="gate" class="modal on" style="place-items:center;background:var(--bg)">
  <div class="sheet" style="max-width:520px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <div style="font-weight:900">Normal Holding</div><div class="muted">Shpenzimet â€¢ Cloud</div>
    </div>
    <div class="row">
      <div style="flex:1">
        <label>Email</label>
        <input id="loginEmail" placeholder="emri@gmail.com" autocomplete="username">
      </div>
      <div style="flex:1">
        <label>FjalÃ«kalimi</label>
        <input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
      </div>
    </div>
    <div class="actions"><button class="btnS" onclick="openReg()">Regjistrohu</button><button class="btnP" onclick="login()">Hyr</button></div>
    <div id="authMsg" class="muted" style="margin-top:6px;font-size:12px"></div>
  </div>
</div>

<!-- ===== KAYIT MODALI ===== -->
<div id="reg" class="modal"><div class="sheet">
  <h3 style="margin:4px 0 8px">Krijo llogari</h3>
  <div class="row"><input id="regEmail" placeholder="emri@gmail.com" autocomplete="username"><input id="regPass" type="password" placeholder="min. 6" autocomplete="new-password"></div>
  <div class="actions"><button class="btnS" onclick="closeModal('reg')">Mbyll</button><button class="btnP" onclick="registerUser()">Regjistrohu</button></div>
  <div id="regMsg" class="muted" style="margin-top:6px;font-size:12px"></div>
</div></div>

<!-- ===== APP ===== -->
<div class="wrap" id="app" style="display:none">
  <header id="hdr">
    <div class="top"><div style="font-weight:800">Normal Holding</div><div class="muted" id="who">@user</div></div>
    <div class="title"><span id="hdrIcon">ğŸ’°</span><span id="hdrText">Bilanci</span></div>
    <div class="big"><span id="hdrTotal">0</span></div>
    <div class="muted" id="hdrSub">Gjendja âˆ’ Shpenzimet (totale)</div>
  </header>

  <div class="stats" id="stats">
    <div class="card"><div class="muted" id="s1name">ğŸ“Š Totale</div><div class="v"><span id="stat1">0</span></div></div>
    <div class="card"><div class="muted" id="s2name">ğŸ“… Sot</div><div class="v"><span id="stat2">0</span></div></div>
    <div class="card"><div class="muted" id="s3name">ğŸ—“ï¸ Muaj</div><div class="v"><span id="stat3">0</span></div></div>
  </div>

  <main>
    <!-- Kreu -->
    <section id="tab-home" class="tab active">
      <h3 class="sec">ğŸ•’ TÃ« fundit</h3>
      <div id="recentList" class="list"></div>
      <div id="emptyHome" class="muted" style="text-align:center;margin:14px 0">AsnjÃ« hyrje deri tani.</div>
    </section>

    <!-- Lista -->
    <section id="tab-list" class="tab">
      <h3 class="sec">ğŸ“š Lista</h3>
      <div class="row" style="margin:8px 0 10px">
        <input id="q" placeholder="KÃ«rko..." oninput="drawAll()">
        <select id="fCat" onchange="drawAll()"><option value="">TÃ« gjitha</option></select>
      </div>
      <div id="allList" class="list"></div>
    </section>

    <!-- Borxhet -->
    <section id="tab-debts" class="tab">
      <h3 class="sec">ğŸ’³ Borxhet</h3>
      <div class="row" style="margin:8px 0 8px"><input id="dq" placeholder="KÃ«rko borxhe..." oninput="drawDebts()"></div>
      <div class="row">
        <div class="card" style="flex:1;padding:6px 8px">
          <div class="row" style="gap:6px">
            <button class="btnMini" data-k="" onclick="setDebtFilter(this)" style="flex:1">TÃ« gjitha</button>
            <button class="btnMini" data-k="borrow" onclick="setDebtFilter(this)" style="flex:1">Mora hua</button>
            <button class="btnMini" data-k="lend" onclick="setDebtFilter(this)" style="flex:1">Dhash hua</button>
          </div>
        </div>
      </div>
      <div id="debtList" class="list"></div>
      <div id="emptyDebts" class="muted" style="text-align:center;margin:14px 0">AsnjÃ« borxh.</div>
    </section>

    <!-- CilÃ«sime -->
    <section id="tab-settings" class="tab">
      <div class="card" style="display:flex;align-items:center;gap:10px">
        <div class="ic">ğŸ‘¤</div>
        <div class="meta"><div class="t">PÃ«rdoruesi</div><div class="s" id="userEmail">â€”</div></div>
        <button class="btnMini" onclick="logout()">Dil</button>
      </div>

      <div class="card" style="margin-top:10px">
        <h3 style="margin:0 0 8px">ğŸ’± Monedha & format</h3>
        <div class="row">
          <div style="flex:1"><label>Monedha aktuale (pÃ«r hyrjet e reja)</label>
            <select id="selCurrency">
              <option value="ALL">ALL â€” Albania Lek</option>
              <option value="EUR">EUR â€” Euro</option>
              <option value="USD">USD â€” US Dollar</option>
              <option value="TRY">TRY â€” Turkish Lira</option>
            </select>
          </div>
          <div style="flex:1"><label>Formati i numrave</label>
            <select id="selFormat">
              <option value="eu">23.456,78</option>
              <option value="us">23,456.78</option>
            </select>
          </div>
        </div>
        <div class="actions"><button class="btnP" onclick="savePrefs()">Ruaj preferencat</button></div>
        <div id="prefMsg" class="muted" style="margin-top:6px;font-size:12px"></div>
      </div>

      <div class="card" style="margin-top:10px">
        <h3 style="margin:0 0 8px">ğŸ’¼ Gjendja e monedhÃ«s aktuale (<span id="balCurr">â€”</span>)</h3>
        <div class="row"><input id="balInput" inputmode="decimal" placeholder="p.sh. 5000"></div>
        <div class="actions"><button class="btnP" onclick="saveBalance()">Ruaj gjendjen</button></div>
        <div id="balMsg" class="muted" style="margin-top:6px;font-size:12px"></div>
      </div>

      <details class="card" style="margin-top:10px">
        <summary style="cursor:pointer;font-weight:800">ğŸ·ï¸ Kategoriat</summary>
        <div id="catList" class="list" style="margin-top:10px"></div>
        <div style="border-top:1px solid var(--border);margin:12px 0"></div>
        <div class="row">
          <button id="emojiBtn" class="btnS" style="width:120px" onclick="openEmojiPicker()">ğŸ™‚ Zgjidh emoji</button>
          <input id="newCatEmoji" value="ğŸ”" hidden>
          <input id="newCatName" style="flex:1" placeholder="p.sh. Ushqime">
        </div>
        <div class="actions"><button class="btnP" onclick="addCategory()">Shto kategori</button></div>
        <div id="catMsg" class="muted" style="margin-top:6px;font-size:12px"></div>
      </details>
    </section>
  </main>
</div>

<!-- Alt menÃ¼ -->
<nav class="nav" id="navbar" style="display:none">
  <a class="btn active" data-tab="home" onclick="switchTab('home')"><span class="ico">ğŸ </span><span>Kreu</span></a>
  <a class="btn" data-tab="list" onclick="switchTab('list')"><span class="ico">ğŸ“‹</span><span>Lista</span></a>
  <a class="btn" data-tab="debts" onclick="switchTab('debts')"><span class="ico">ğŸ’³</span><span>Borxhet</span></a>
  <a class="btn" data-tab="settings" onclick="switchTab('settings')"><span class="ico">âš™ï¸</span><span>CilÃ«sime</span></a>
  <button class="fab" id="openAdd" aria-label="Shto">ï¼‹</button>
</nav>

<!-- Modal: Sh

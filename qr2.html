<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Barkod Okuyucu</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 0; background: #f2f2f2; }
  #reader { width: 100%; max-width: 400px; margin: 20px auto; }
  #resultList { margin: 20px auto; width: 90%; text-align: left; }
  li { padding: 5px 0; border-bottom: 1px solid #ddd; }
  .btns { margin: 20px; }
  button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
  #copyBtn { background: #007bff; color: #fff; }
  #whatsappBtn { background: #25D366; color: #fff; }
  #overlay {
    position: absolute; top:0; left:0; width:100%; height:100%;
    pointer-events:none; border: 10px solid transparent; box-sizing:border-box;
  }
  #notify {
    position: fixed; top:-60px; left:50%; transform:translateX(-50%);
    background:#4CAF50; color:#fff; padding:15px 25px; border-radius:5px;
    font-size:18px; transition:top 0.5s; z-index:9999;
  }
  #notify.error { background:#E74C3C; }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h2>Barkod Okuyucu</h2>
<div id="reader"></div>
<div id="overlay"></div>
<ul id="resultList"></ul>

<div class="btns">
  <button id="copyBtn">ðŸ“‹ Kopyala</button>
  <button id="whatsappBtn">ðŸ“² WhatsApp'tan GÃ¶nder</button>
</div>

<div id="notify"></div>

<audio id="successSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="errorSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let scanned = [];
let count = 0;

function showNotification(text, isError=false){
  const notify = document.getElementById("notify");
  notify.textContent = text;
  notify.className = isError ? "error" : "";
  notify.style.top = "20px";
  setTimeout(()=>{ notify.style.top = "-60px"; }, 2000);
}

function onScanSuccess(decodedText) {
  // linkten sadece son 4 karakteri al
  let code = decodedText.slice(-4);
  
  const overlay = document.getElementById("overlay");
  
  if(scanned.includes(code)){
    document.getElementById("errorSound").play();
    overlay.style.borderColor="red";
    setTimeout(()=> overlay.style.borderColor="transparent",500);
    showNotification(code + " zaten okutuldu!", true);
    return;
  }
  
  scanned.push(code);
  count++;
  
  let li = document.createElement("li");
  li.textContent = count + ". " + code;
  document.getElementById("resultList").appendChild(li);
  
  document.getElementById("successSound").play();
  overlay.style.borderColor="lime";
  setTimeout(()=> overlay.style.borderColor="transparent",500);
  showNotification(code + " eklendi âœ…");
}

function copyList(){
  let text = scanned.map((c,i)=> (i+1)+". "+c).join("\n");
  navigator.clipboard.writeText(text);
  alert("Liste kopyalandÄ±!");
}

function sendWhatsApp(){
  let text = scanned.map((c,i)=> (i+1)+". "+c).join("%0A");
  window.open("https://wa.me/?text="+text,"_blank");
}

document.getElementById("copyBtn").onclick = copyList;
document.getElementById("whatsappBtn").onclick = sendWhatsApp;

new Html5Qrcode("reader").start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
</script>

</body>
</html>

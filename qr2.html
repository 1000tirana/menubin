<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Skano Kodet</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body{margin:0;font-family:sans-serif;background:#111;color:#eee;text-align:center}
  #reader{width:100%;max-width:400px;margin:20px auto}
  #overlay{position:absolute;inset:0;border:6px solid transparent;pointer-events:none;transition:.3s}
  .controls{margin:10px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  select,button{padding:10px 14px;border-radius:8px;border:1px solid #444;background:#222;color:#fff;cursor:pointer}
  button.primary{background:#007bff}
  ul{list-style:none;padding:0;margin:20px auto;max-width:400px;text-align:left;background:#222;border-radius:8px}
  li{padding:8px 12px;border-top:1px solid #333}
  li:first-child{border-top:0}
</style>
</head>
<body>
<h2>ðŸ“· Skano Kodet</h2>

<div style="position:relative;max-width:400px;margin:auto">
  <div id="reader"></div>
  <div id="overlay"></div>
</div>

<div class="controls">
  <select id="camSelect"></select>
  <button id="startBtn" class="primary">KamerayÄ± AÃ§</button>
  <button id="flipBtn">â†º Kamera DeÄŸiÅŸtir</button>
  <button id="stopBtn">â–  Stop</button>
</div>

<ul id="list"></ul>

<audio id="okS" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="erS" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let html5=null, scanned=[], cams=[], currentId=null;

function extractCode(txt){
  try{const u=new URL(txt);const last=u.pathname.split("/").pop();if(last) return last.slice(-4);}catch(e){}
  return txt.slice(-4);
}
function renderList(){list.innerHTML=scanned.map((c,i)=><li>${i+1}. ${c}</li>).join("");}
function green(){overlay.style.borderColor="lime";setTimeout(()=>overlay.style.borderColor="transparent",500);}
function red(){overlay.style.borderColor="red";setTimeout(()=>overlay.style.borderColor="transparent",500);}

async function loadCams(){
  cams=await Html5Qrcode.getCameras();
  camSelect.innerHTML=cams.map(c=><option value="${c.id}">${c.label||c.id}</option>).join("");
  // back camera varsayÄ±lan
  const back=cams.find(c=>/back|rear|environment/i.test(c.label));
  if(back) camSelect.value=back.id;
}
async function start(id){
  if(html5){try{await html5.stop();}catch{}}
  html5=new Html5Qrcode("reader");
  const config={fps:10,qrbox:250};
  await html5.start(id?{deviceId:{exact:id}}:{facingMode:"environment"},config,onScan);
  currentId=id;
}
function onScan(txt){
  let code=extractCode(txt).toUpperCase();
  if(scanned.includes(code)){erS.play();red();return;}
  scanned.push(code);okS.play();green();renderList();
}
startBtn.onclick=()=>start(camSelect.value);
stopBtn.onclick=()=>html5&&html5.stop();
flipBtn.onclick=()=>{
  if(!cams.length) return;
  let idx=cams.findIndex(c=>c.id===currentId);
  let next=cams[(idx+1)%cams.length];
  camSelect.value=next.id;
  start(next.id);
};

loadCams();
</script>
</body>
</html>

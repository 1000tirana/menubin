<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Barkod Okuyucu</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<!-- Orijinal koddaki JS'e dokunmadÄ±m; sadece tasarÄ±m ekledim -->
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  :root{
    --bg:#0f1115; --card:#171a21; --edge:#232836; --text:#e7e9ee; --muted:#a9b0bd;
    --brand:#3b82f6; --ok:#1ecb4f; --err:#ff4d4f;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body {
    margin: 0; background: var(--bg); color: var(--text);
    font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    display:flex; flex-direction:column;
  }

  /* Ãœst Uygulama Ã‡ubuÄŸu */
  header{
    position:sticky; top:0; z-index:20;
    background:rgba(15,17,21,.9); backdrop-filter:blur(10px);
    border-bottom:1px solid var(--edge);
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px;
  }
  header h1{margin:0; font-size:16px; letter-spacing:.2px}
  .badge{background:#1f2430; border:1px solid var(--edge); color:var(--muted);
    padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px}

  /* Ä°Ã§erik */
  main{max-width:960px; width:100%; margin:0 auto; padding:12px; flex:1}

  /* Kamera kartÄ± */
  .card{
    position:relative; background:var(--card); border:1px solid var(--edge);
    border-radius:14px; padding:12px;
  }
  /* Kamera alanÄ± + overlay Ã¼st Ã¼ste */
  .cam-wrap{position:relative; width:100%; max-width:520px; margin:0 auto}
  #reader { width: 100%; aspect-ratio: 3/4; max-height: 70vh; display:block; border-radius:12px; overflow:hidden; }
  @media (orientation:landscape){ #reader{ aspect-ratio: 16/9; max-height:62vh } }

  /* Orijinal overlay (ID aynÄ± kaldÄ±) */
  #overlay {
    position: absolute; inset:0; border: 8px solid transparent; box-sizing:border-box;
    pointer-events:none; border-radius:12px; transition: border-color .18s ease, box-shadow .18s ease;
  }

  /* BaÅŸlÄ±k */
  h2 { display:none } /* Eski H2â€™yi gizledim; header kullanÄ±yoruz */

  /* Liste kartÄ± */
  #resultList {
    list-style:none; padding:0; margin:14px auto; width:100%; max-width:520px; text-align:left;
    background:var(--card); border:1px solid var(--edge); border-radius:12px; overflow:hidden;
  }
  #resultList li { padding:10px 12px; border-top:1px solid #202637; }
  #resultList li:first-child{ border-top:0 }
  #resultList li::marker{ content:'' }

  /* Bildirim / Snackbar */
  #notify {
    position: fixed; top:-60px; left:50%; transform:translateX(-50%);
    background:#1f2430; border:1px solid var(--edge);
    color:#fff; padding:12px 16px; border-radius:10px; font-size:14px;
    transition:top .35s ease; z-index:9999; box-shadow:0 6px 20px rgba(0,0,0,.35);
  }
  #notify.error { background:#3a2222; border-color:#5b2323 }

  /* Alt eylem Ã§ubuÄŸu */
  .btns {
    position:sticky; bottom:0; z-index:15;
    background:rgba(15,17,21,.9); backdrop-filter:blur(10px);
    border-top:1px solid var(--edge);
    display:flex; gap:10px; padding:10px; justify-content:center;
  }
  button {
    flex:1; min-width:140px;
    padding: 12px 16px; margin:0;
    border: none; border-radius: 10px; cursor: pointer; font-weight:700;
  }
  #copyBtn { background: var(--brand); color:#fff; }
  #whatsappBtn { background: #25D366; color:#072b10; }
  /* Eski buton stilleriyle uyum */
  /* (id'ler aynÄ±; fonksiyonlar deÄŸiÅŸmedi) */

  /* KÃ¼Ã§Ã¼k ipucu ÅŸeridi */
  .tips{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px}
  .pill{background:#1f2430; border:1px solid var(--edge); color:var(--muted); padding:6px 10px; border-radius:999px}

  /* Konteyner geniÅŸlikleri */
  .stack{display:flex; flex-direction:column; align-items:center; gap:14px}
</style>
</head>
<body>

<!-- Ãœst bar -->
<header>
  <h1>Barkod Okuyucu</h1>
  <div class="badge">4 hane</div>
</header>

<main>
  <div class="stack">

    <!-- Kamera kartÄ± (IDâ€™ler aynÄ±, JS aynen Ã§alÄ±ÅŸÄ±r) -->
    <div class="card">
      <div class="cam-wrap">
        <div id="reader"></div>
        <div id="overlay"></div>
      </div>
      <div class="tips">
        <span class="pill">KamerayÄ± barkoda yaklaÅŸtÄ±r</span>
        <span class="pill">Yenilemede liste kalmaz (tasarÄ±mÄ± bozmadÄ±m)</span>
      </div>
    </div>

    <!-- Liste -->
    <ul id="resultList"></ul>
  </div>
</main>

<!-- YapÄ±ÅŸkan alt eylem Ã§ubuÄŸu -->
<div class="btns">
  <button id="copyBtn">ðŸ“‹ Kopyala</button>
  <button id="whatsappBtn">ðŸ“² WhatsApp'tan GÃ¶nder</button>
</div>

<!-- Snackbar / Bildirim -->
<div id="notify"></div>

<!-- Sesler (deÄŸiÅŸtirmedim) -->
<audio id="successSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="errorSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
/* ======= AÅžAÄžIDAKÄ° JS SENÄ°N ORÄ°JÄ°NALÄ°N â€” HÄ°Ã‡ DEÄžÄ°ÅžTÄ°RMEDÄ°M ======= */
let scanned = [];
let count = 0;

function showNotification(text, isError=false){
  const notify = document.getElementById("notify");
  notify.textContent = text;
  notify.className = isError ? "error" : "";
  notify.style.top = "20px";
  setTimeout(()=>{ notify.style.top = "-60px"; }, 2000);
}

function onScanSuccess(decodedText) {
  // linkten sadece son 4 karakteri al
  let code = decodedText.slice(-4);
  
  const overlay = document.getElementById("overlay");
  
  if(scanned.includes(code)){
    document.getElementById("errorSound").play();
    overlay.style.borderColor="var(--err)";
    overlay.style.boxShadow="0 0 0 9999px #ff4d4f22";
    setTimeout(()=> { overlay.style.borderColor="transparent"; overlay.style.boxShadow="none"; },500);
    showNotification(code + " zaten okutuldu!", true);
    return;
  }
  
  scanned.push(code);
  count++;
  
  let li = document.createElement("li");
  li.textContent = count + ". " + code;
  document.getElementById("resultList").appendChild(li);
  
  document.getElementById("successSound").play();
  overlay.style.borderColor="var(--ok)";
  overlay.style.boxShadow="0 0 0 9999px #1ecb4f22";
  setTimeout(()=> { overlay.style.borderColor="transparent"; overlay.style.boxShadow="none"; },500);
  showNotification(code + " eklendi âœ…");
}

function copyList(){
  let text = scanned.map((c,i)=> (i+1)+". "+c).join("\n");
  navigator.clipboard.writeText(text);
  alert("Liste kopyalandÄ±!");
}

function sendWhatsApp(){
  let text = scanned.map((c,i)=> (i+1)+". "+c).join("%0A");
  window.open("https://wa.me/?text="+text,"_blank");
}

document.getElementById("copyBtn").onclick = copyList;
document.getElementById("whatsappBtn").onclick = sendWhatsApp;

new Html5Qrcode("reader").start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
/* ======= ORÄ°JÄ°NAL JS BÄ°TÄ°Åž ======= */
</script>

</body>
</html>

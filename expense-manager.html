<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Andi – Shpenzimet e Shtëpisë</title>
<style>
  /* ——— Tema & renk paleti ——— */
:root{
  --bg:#f6f7fb; 
  --card:#ffffff;
  --ink:#14161a;
  --muted:#8a90a0;
  --line:#e7eaf0;
  --accent:#ff5a5f;
  --blue:#1e88e5;      /* gelir */
  --red:#e53935;       /* gider */
  --green:#2e7d32;     /* toplam + */
  --amber:#f6b100;
}

/* Başlık daha app-vari */
.header{
  background: linear-gradient(180deg,#fff 0%,rgba(255,255,255,.96) 70%,rgba(255,255,255,.90) 100%);
  backdrop-filter: saturate(140%) blur(4px);
}

/* KPI kartları – yumuşak gradient ve daha güçlü tipografi */
.kpi{
  border: 1px solid var(--line);
  box-shadow: 0 6px 18px rgba(20,22,26,.04);
  background: linear-gradient(180deg,#ffffff 0%,#fafbff 100%);
}
.kpi .v{ font-weight:800 }

/* Liste satırı – daha okunaklı ve “kart” etkisi */
.list .row{
  background:#fff;
  transition: transform .08s ease, box-shadow .08s ease;
}
.list .row:hover{ transform: translateY(-1px); box-shadow: 0 8px 16px rgba(0,0,0,.04); }

/* Dot rengi, satırın gelir/gider olmasına göre değişsin (CSS :has) */
.list .row:has(.amount.income) .dot{ background:#e7f2ff; color:var(--blue) }
.list .row:has(.amount.expense) .dot{ background:#ffe9ea; color:var(--red) }

/* Tutar renkleri */
.amount.income{ color:var(--blue) }
.amount.expense{ color:var(--red) }

/* Alt menü – ikonlu, büyük dokunma hedefi */
.navbar{ backdrop-filter: saturate(140%) blur(6px) }
.navbtn{
  border-radius:12px;
  padding:10px 14px;
}
.navbtn.active{ background:#ff5a5f; color:#fff }
.navbtn[data-tab="daily"]::before{ content:"📋"; margin-right:6px }
.navbtn[data-tab="summary"]::before{ content:"📊"; margin-right:6px }
.navbtn[data-tab="settings"]::before{ content:"⚙️"; margin-right:6px }

/* FAB – daha canlı ve gölgeli */
.fab{
  box-shadow: 0 14px 28px rgba(255,90,95,.35), 0 2px 8px rgba(0,0,0,.1);
  border: none;
}

/* Buton ikonları (CSV/del) */
#exportBtn::before{ content:"⬇️"; margin-right:6px }
#wipeBtn::before{ content:"🗑️"; margin-right:6px }

/* Form kontrolleri – daha temiz ve app hissi */
.input, select, textarea{
  background:#fff;
  border:1px solid var(--line);
  box-shadow: inset 0 1px 0 rgba(20,22,26,.02);
}
.input:focus, select:focus, textarea:focus{
  outline:none;
  border-color:#cfd6ff;
  box-shadow:0 0 0 3px rgba(66,99,235,.15);
}

/* Sheet panel – daha güçlü üst kenar */
.panel{ box-shadow: 0 -12px 28px rgba(0,0,0,.12) }

/* —— (isteğe bağlı) Takvim & Pasta grafiği hazır stilleri —— */
/* Eğer daha sonra #calendar veya #pie canvas eklersen bu renkleri kullanır */
.calendar{ padding:10px; background:#fff; border:1px solid var(--line); border-radius:16px }
.calendar .cell{ border-radius:12px; border:1px solid var(--line) }
#pie{ display:block; margin:0 auto }
.legend .badge{ border:1px solid rgba(0,0,0,.08) }
:root{--bg:#f6f7fb; --card:#ffffff; --ink:#1b1d23; --muted:#8a90a0; --line:#e9ecf2; --accent:#ff5a5f; --blue:#1e88e5; --red:#e53935}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.app{max-width:560px;margin:0 auto;min-height:100%;display:flex;flex-direction:column}
.header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,#fff,rgba(255,255,255,.95));border-bottom:1px solid var(--line);padding:12px 16px}
.h1{font-weight:800;font-size:18px;display:flex;justify-content:space-between;align-items:center}
.kpis{display:flex;gap:8px;margin-top:10px}
.kpi{flex:1;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;text-align:center;font-weight:700}
.kpi .v{display:block;margin-top:2px}
.blue{color:var(--blue)} .red{color:var(--red)}
.content{flex:1;padding:12px 12px 96px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.05)}
.list .row{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;padding:12px;border-top:1px solid var(--line)}
.list .row:first-child{border-top:none}
.dot{width:42px;height:42px;border-radius:12px;background:#f0f2f6;display:flex;align-items:center;justify-content:center;font-weight:800}
.title2{font-weight:700}
.note{font-size:12px;color:var(--muted);margin-top:2px}
.amount{font-weight:800}
.amount.income{color:var(--blue)} .amount.expense{color:var(--red)}
/* bottom nav & fab */
.navbar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);z-index:8}
.nav{max-width:560px;margin:0 auto;display:flex;justify-content:space-around;padding:8px}
.navbtn{background:none;border:none;font-weight:800;color:#555;padding:10px}
.navbtn.active{color:#111}
.fab{position:fixed;right:18px;bottom:86px;width:56px;height:56px;border-radius:16px;background:var(--accent);color:#fff;border:none;font-size:28px;z-index:999;cursor:pointer;box-shadow:0 12px 24px rgba(255,90,95,.35)}
/* sheet */
.sheet{position:fixed;inset:0;background:rgba(0,0,0,.25);display:none;align-items:flex-end;z-index:20}
.sheet.show{display:flex}
.panel{background:#fff;border-radius:18px 18px 0 0;max-width:560px;margin:0 auto;width:100%;padding:14px}
.grid{display:grid;gap:10px}
.row2{display:flex;gap:10px}
input,select,textarea,button{font-size:16px !important}
.input,select,textarea{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff}
.btn{padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff;font-weight:700;cursor:pointer}
.btn.primary{background:#111;color:#fff;border-color:#111}
.small{font-size:12px;color:var(--muted)}
.center{display:flex;align-items:center;justify-content:center}
.hidden{display:none}
</style>
</head>
<body>
<div class="app">

  <!-- HEADER (no top tabs) -->
  <div class="header">
    <div class="h1">Transaksione <span class="small">ALL (L)</span></div>
    <div class="kpis">
      <div class="kpi">Të ardhura <span id="kpiIncome" class="v blue">L 0</span></div>
      <div class="kpi">Shpenzime <span id="kpiExpense" class="v red">L 0</span></div>
      <div class="kpi">Totali <span id="kpiTotal" class="v">L 0</span></div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">
    <!-- DITORE -->
    <div id="view-daily">
      <div class="card list" id="dailyList"></div>
    </div>

    <!-- PËRMBLEDHJE -->
    <div id="view-summary" class="hidden">
      <div class="card" style="padding:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="exportBtn">Eksporto CSV</button>
        <label class="btn">Ngarko CSV <input id="importInput" type="file" accept=".csv" class="hidden"></label>
        <button class="btn" id="wipeBtn">Fshi të dhënat</button>
        <div class="small" style="width:100%">Të dhënat ruhen në shfletues (localStorage). Mund t’i ruash/ngarkosh si CSV.</div>
      </div>
    </div>

    <!-- CILËSIMET -->
    <div id="view-settings" class="hidden">
      <div class="card" style="padding:12px">
        <div class="small">Monedha: <b>ALL (L)</b>. Shuma futet si numër i plotë.</div>
      </div>
    </div>
  </div>

  <!-- SINGLE MENU (only bottom) -->
  <div class="navbar">
    <div class="nav">
      <button class="navbtn active" data-tab="daily">Regjistrimet</button>
      <button class="navbtn" data-tab="summary">Përmbledhje</button>
      <button class="navbtn" data-tab="settings">Cilësimet</button>
    </div>
  </div>

  <!-- FAB -->
  <button class="fab" id="addBtn" aria-label="Shto">+</button>

  <!-- SHEET -->
  <div class="sheet" id="sheet">
    <div class="panel">
      <h3>Regjistrim i ri</h3>
      <div class="grid">
        <div class="row2">
          <select id="type">
            <option value="expense">Shpenzim</option>
            <option value="income">Të ardhura</option>
          </select>
          <input id="date" type="date" class="input">
        </div>
        <input id="amount" class="input" inputmode="numeric" pattern="[0-9]*" placeholder="Shuma (L) – numër i plotë">
        <select id="category" class="input">
          <option>Qira</option><option>Fatura e ujit</option><option>Fatura e energjisë</option>
          <option>Interneti</option><option>Blerje ushqimore për shtëpi</option>
          <option>Detergjent rrobash</option><option>Rroba</option><option>Vakt jashtë</option><option>Tjetër</option>
        </select>
        <input id="account" class="input" value="Cash" placeholder="Llogaria (Cash/Kartë/Kursim)">
        <input id="note" class="input" placeholder="Shënim (opsionale)">
        <div class="row2">
          <button class="btn" id="closeSheet">Mbyll</button>
          <button class="btn primary" id="save">Ruaj</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
  const fmt=n=>"L "+(n||0).toString().replace(/\B(?=(\\d{3})+(?!\\d))/g," ");
  const sot=()=>new Date().toISOString().slice(0,10);
  const uid=()=>Math.random().toString(36).slice(2,10);
  const LS='andi-shpenzimet-v2'; let items=[];

  function ngarko(){ try{const raw=localStorage.getItem(LS); if(raw) items=JSON.parse(raw)||[];}catch(e){} }
  function ruaj(){ localStorage.setItem(LS, JSON.stringify(items)); }

  function kalo(tab){
    ['daily','summary','settings'].forEach(v=>{
      $('#view-'+v).classList.toggle('hidden', v!==tab);
      $$('.navbtn').forEach(b=> b.classList.toggle('active', b.dataset.tab===tab));
    });
  }

  function render(){
    let tA=0, sh=0; items.forEach(i=> i.type==='income'? tA+=i.amount : sh+=i.amount);
    $('#kpiIncome').textContent=fmt(tA);
    $('#kpiExpense').textContent=fmt(sh);
    $('#kpiTotal').textContent=fmt(tA-sh);

    const box=$('#dailyList'); box.innerHTML='';
    if(!items.length){ box.innerHTML='<div class="center" style="padding:16px;color:#888">Ende s’ka regjistrime</div>'; return; }
    [...items].sort((a,b)=> new Date(b.date)-new Date(a.date)).forEach(i=>{
      const d=new Date(i.date); const wd=d.toLocaleDateString('sq-AL',{weekday:'short'});
      box.insertAdjacentHTML('beforeend', `
        <div class="row">
          <div class="dot">${d.getDate()}</div>
          <div>
            <div class="title2">${i.category}</div>
            <div class="note">${i.account} • ${wd}${i.note?' • '+i.note:''}</div>
          </div>
          <div class="amount ${i.type==='income'?'income':'expense'}">${(i.type==='income'?'+':'-')+fmt(i.amount)}</div>
        </div>`);
    });
  }

  function eksportCSV(){
    const rows=[['id','date','type','amount','category','account','note']];
    items.forEach(i=> rows.push([i.id,i.date,i.type,i.amount,i.category,i.account,i.note||'']));
    const csv=rows.map(r=>r.map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\\n');
    const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv;charset=utf-8;'}));
    a.download='andi-shpenzimet.csv'; a.click();
  }
  function importCSV(txt){
    const lines=txt.split(/\\r?\\n/).filter(Boolean); if(!lines.length) return;
    const head=lines.shift().split(',').map(s=>s.replace(/^"|"$/g,'')); const idx={}; head.forEach((c,i)=>idx[c]=i);
    lines.forEach(line=>{
      const arr=[]; let cur='',q=false;
      for(const ch of line){ if(ch=='"'){q=!q;continue;} if(ch==','&&!q){arr.push(cur);cur='';} else cur+=ch; } arr.push(cur);
      const g=k=>(arr[idx[k]]||'').replace(/^"|"$/g,'');
      items.push({ id:g('id')||uid(), date:g('date')||sot(), type:g('type')==='income'?'income':'expense',
        amount:parseInt((g('amount')||'').replace(/\\D/g,''))||0, category:g('category')||'Tjetër',
        account:g('account')||'Cash', note:g('note')||'' });
    });
    ruaj(); render();
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    ngarko(); render(); kalo('daily');

    // alt menü (tek menü)
    $$('.navbtn').forEach(b=> b.addEventListener('click', ()=> kalo(b.dataset.tab)));

    // ekleme paneli
    $('#addBtn').addEventListener('click', ()=>{
      $('#date').value=sot(); $('#type').value='expense'; $('#amount').value='';
      $('#category').value='Blerje ushqimore për shtëpi'; $('#account').value='Cash'; $('#note').value='';
      $('#sheet').classList.add('show');
    });
    $('#closeSheet').onclick=()=> $('#sheet').classList.remove('show');
    $('#save').onclick=()=> {
      const amt=parseInt(($('#amount').value||'').replace(/\\D/g,''))||0;
      if(!amt){ alert('Shkruaj shumën (numër i plotë).'); return; }
      items.push({ id:uid(), date:$('#date').value||sot(), type:$('#type').value, amount:amt,
                   category:$('#category').value, account:$('#account').value||'Cash', note:($('#note').value||'').trim() });
      ruaj(); render(); $('#sheet').classList.remove('show');
      if(confirm('Ta shkarkoj CSV?')) eksportCSV();
    };

    // CSV
    $('#exportBtn').onclick=eksportCSV;
    $('#importInput').onchange=e=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=ev=>{ importCSV(ev.target.result); alert('U ngarkua.'); };
      r.readAsText(f,'utf-8'); e.target.value='';
    };
    $('#wipeBtn').onclick=()=>{ if(!confirm('Të gjitha të dhënat të fshihen?')) return; items=[]; ruaj(); render(); };
  });
})();
</script>
</body>
</html>

<!doctype html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Dërgo Lokacionin në WhatsApp</title>
<style>
  :root{
    --bg:#0f1115; --card:#171a21; --text:#e7ebf5; --muted:#a9b1c3; --accent:#2ecc71; --warn:#ffb020; --danger:#ff5d5d;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:100%;max-width:520px;background:var(--card);border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 8px;font-size:22px}
  p{margin:8px 0;color:var(--muted);line-height:1.45}
  .status{margin:14px 0 10px;padding:12px;border-radius:12px;background:#11151d;color:var(--muted);font-size:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button,a.btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;text-decoration:none}
  .primary{background:var(--accent);color:#0b1b12}
  .ghost{background:#202736;color:var(--text)}
  .small{font-size:12px;color:var(--muted);margin-top:10px}
  .hide{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Dërgo Lokacionin tënd</h1>
  <p>Kjo faqe do të marrë lokacionin tënd dhe do të përgatisë një mesazh në WhatsApp për numrin e caktuar.</p>

  <div id="status" class="status">Duke u përgatitur…</div>

  <div class="row">
    <button id="retry" class="ghost hide">Provo përsëri</button>
    <a id="openWA" class="btn primary hide" target="_self" rel="noopener">Hape WhatsApp</a>
  </div>

  <p class="small">
    ⚠️ Duhet <strong>HTTPS</strong> që të funksionojë. WhatsApp lejon vetëm ndarjen manuale të "live location", këtu dërgohet një link i Google Maps.
  </p>
</div>

<script>
(function(){
  const PHONE = "355674001991"; // Numri i fiksuar

  const statusEl = document.getElementById("status");
  const retryBtn = document.getElementById("retry");
  const openWA  = document.getElementById("openWA");

  function buildWhatsAppUrl(text){
    const encoded = encodeURIComponent(text);
    return https://wa.me/${PHONE}?text=${encoded};
  }

  function setStatus(msg, type="info"){
    statusEl.textContent = msg;
    statusEl.style.color = (type==="error") ? "#ffbcbc" : (type==="warn" ? "#ffdca3" : "var(--muted)");
    statusEl.style.background = (type==="error") ? "#2a0f13" : (type==="warn" ? "#2a2413" : "#11151d");
  }

  function openWhatsAppWith(lat, lng){
    const ts = new Date().toLocaleString("sq-AL");
    const maps = https://maps.google.com/?q=${lat},${lng};
    const text =
`📍 Lokacioni im:
${maps}

Koordinatat: ${lat.toFixed(6)}, ${lng.toFixed(6)}
Koha: ${ts}`;

    const url = buildWhatsAppUrl(text);
    openWA.href = url;
    openWA.classList.remove("hide");
    try { window.location.replace(url); } catch(e) {}
  }

  function handleGeoError(err){
    if (err && err.code === 1) {
      setStatus("Leja për lokacionin u refuzua. Aktivizo GPS dhe jep leje.", "warn");
    } else if (err && err.code === 2) {
      setStatus("Nuk u gjet burimi i lokacionit. Aktivizo internetin / GPS.", "warn");
    } else if (err && err.code === 3) {
      setStatus("Kërkesa për lokacion skadoi. Provo përsëri.", "warn");
    } else {
      setStatus("Nuk u mor lokacioni. Provo përsëri.", "warn");
    }
    retryBtn.classList.remove("hide");
  }

  function requestGeo(){
    retryBtn.classList.add("hide");
    openWA.classList.add("hide");
    setStatus("Duke marrë lokacionin… Jep leje nëse kërkohet.");
    if (!("geolocation" in navigator)) {
      setStatus("Ky pajisje nuk mbështet lokacion.", "error");
      openWA.href = buildWhatsAppUrl("Dua të ndaj lokacionin tim:");
      openWA.classList.remove("hide");
      return;
    }
    navigator.geolocation.getCurrentPosition(
      (pos)=>{
        const { latitude, longitude } = pos.coords || {};
        if (typeof latitude !== "number" || typeof longitude !== "number") {
          handleGeoError();
          return;
        }
        setStatus("Lokacioni u mor, WhatsApp po hapet…");
        openWhatsAppWith(latitude, longitude);
      },
      handleGeoError,
      { enableHighAccuracy:true, timeout:12000, maximumAge:0 }
    );
  }

  retryBtn.addEventListener("click", requestGeo);
  requestGeo();
})();
</script>
</body>
</html>

<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Video Bul & İndir (İstemci Tarafı)</title>
<style>
  :root { --gap:12px; --radius:12px; }
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;margin:0;background:#0f1115;color:#e9eef5}
  header{padding:20px 16px;border-bottom:1px solid #2a2f3a;background:#0b0d12;position:sticky;top:0}
  h1{font-size:18px;margin:0 0 6px}
  small{color:#a9b6c6}
  main{max-width:920px;margin:0 auto;padding:18px 16px 40px}
  .card{background:#121622;border:1px solid #272c39;border-radius:var(--radius);padding:16px;margin-bottom:var(--gap)}
  .row{display:flex;flex-wrap:wrap;gap:var(--gap)}
  .col{flex:1 1 320px;min-width:280px}
  label{display:block;margin:0 0 8px;color:#c9d4e3}
  textarea,input,button{width:100%;box-sizing:border-box}
  textarea{min-height:160px;padding:12px;border-radius:10px;border:1px solid #2b3242;background:#0c1019;color:#e9eef5;resize:vertical}
  input{padding:10px;border-radius:10px;border:1px solid #2b3242;background:#0c1019;color:#e9eef5}
  button{cursor:pointer;padding:12px 14px;border:0;border-radius:10px;background:#2f6fed;color:white;font-weight:600}
  button.secondary{background:#1f2533}
  button:disabled{opacity:.5;cursor:not-allowed}
  .hint{font-size:13px;color:#9fb0c6;margin-top:6px}
  .results{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:var(--gap)}
  .pill{display:inline-block;background:#1a2030;border:1px solid #2a3145;color:#b9c7db;border-radius:999px;padding:4px 10px;font-size:12px;margin-right:6px}
  .item{background:#0d1320;border:1px solid #27324a;border-radius:12px;padding:12px}
  .item strong{display:block;margin-bottom:6px;color:#fff}
  .item code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:12px}
  .actions{display:flex;gap:8px;margin-top:10px}
  a.dl, .copy{flex:1;text-align:center;text-decoration:none}
  .copy{background:#1f2535;color:#d7e2f3;border-radius:10px;padding:10px;font-weight:600}
  .tag{font-size:12px;color:#9fb0c6}
  footer{max-width:920px;margin:0 auto;padding:24px 16px;color:#9fb0c6}
  .warn{background:#201314;border:1px solid #5f2024;color:#ffb3b8;padding:8px 10px;border-radius:8px;font-size:13px}
</style>
</head>
<body>
<header>
  <h1>Video Bul & İndir</h1>
  <small>Yalnızca indirme hakkın olan içerikler için. DRM/HLS/CORS kısıtları bu araçla aşılmaz.</small>
</header>
<main>
  <div class="card">
    <div class="row">
      <div class="col">
        <label>1) Sayfa Adresi (opsiyonel)</label>
        <input id="pageUrl" placeholder="https://... (CORS açıksa çalışır)">
        <div class="hint">Birçok site CORS engeli koyar; çalışmazsa sağdaki yöntemle HTML’yi yapıştır.</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="fetchBtn">URL’den Tara</button>
          <button id="bookmarkletBtn" class="secondary">Sayfada Çalışan Bookmarklet</button>
        </div>
      </div>
      <div class="col">
        <label>2) HTML Kaynağını Yapıştır (önerilen)</label>
        <textarea id="htmlInput" placeholder="Sayfanın kaynak kodunu buraya yapıştır..."></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="parseBtn">Yapıştırılan HTML’yi Tara</button>
          <button id="clearBtn" class="secondary">Temizle</button>
        </div>
        <div class="hint">İpucu: Çoğu oynatıcıda sağ tık &gt; “View page source” veya geliştirici araçlarından kopyalayabilirsin.</div>
      </div>
    </div>
  </div>

  <div class="card">
    <strong>Bulunan Videolar</strong>
    <div id="counts" class="hint" style="margin:6px 0 10px"></div>
    <div id="results" class="results"></div>
    <div id="none" class="hint">Henüz bir şey bulunmadı.</div>
    <div id="hlsWarn" class="warn" style="display:none;margin-top:12px">
      Bazı bağlantılar <b>M3U8/HLS</b> akışıdır (tek MP4 dosyası değildir). Bunları tarayıcıdan doğrudan tek dosya olarak indirmek mümkün olmayabilir.
    </div>
  </div>
</main>

<footer>
  <div class="hint">
    Desteklenen türler: <span class="pill">.mp4</span><span class="pill">.webm</span><span class="pill">.ogg</span><span class="pill">.m3u8 (HLS)</span><span class="pill">.mpd (DASH)</span><br>
    İpuçları: ① Gömülü iframe’lerin <code>src</code> adresini de yapıştır. ② <code>&lt;video&gt;</code>/<code>&lt;source&gt;</code> bloklarını doğrudan yapıştırırsan en sağlıklısı.
  </div>
</footer>

<script>
const pageUrl = document.getElementById('pageUrl');
const htmlInput = document.getElementById('htmlInput');
const fetchBtn = document.getElementById('fetchBtn');
const parseBtn = document.getElementById('parseBtn');
const clearBtn = document.getElementById('clearBtn');
const resultsEl = document.getElementById('results');
const noneEl = document.getElementById('none');
const countsEl = document.getElementById('counts');
const hlsWarn = document.getElementById('hlsWarn');
const bookmarkletBtn = document.getElementById('bookmarkletBtn');

const EXT_TYPE = (u)=>{
  try{
    const url = new URL(u, location.href);
    const path = url.pathname.toLowerCase();
    if (path.endsWith('.mp4')) return {type:'video/mp4', ext:'mp4'};
    if (path.endsWith('.webm')) return {type:'video/webm', ext:'webm'};
    if (path.endsWith('.ogg') || path.endsWith('.ogv')) return {type:'video/ogg', ext:'ogg'};
    if (path.endsWith('.m3u8')) return {type:'application/vnd.apple.mpegurl', ext:'m3u8', hls:true};
    if (path.endsWith('.mpd')) return {type:'application/dash+xml', ext:'mpd', dash:true};
    return {type:'', ext:''};
  }catch(_){ return {type:'', ext:''}; }
};

function uniq(arr){ return Array.from(new Set(arr)); }

function pickName(u){
  try{
    const url = new URL(u, location.href);
    const base = url.pathname.split('/').pop() || 'video';
    return base.split('?')[0] || 'video';
  }catch(_){ return 'video'; }
}

function collectFromDoc(doc){
  const urls = [];
  const push = v => { if(v && typeof v === 'string'){ try{ urls.push(new URL(v, doc.baseURI||location.href).href); }catch{ /* ignore */ } } };

  // <video src>, <video><source>, data-* attributes commonly used by players
  doc.querySelectorAll('video').forEach(v=>{
    push(v.getAttribute('src'));
    v.querySelectorAll('source').forEach(s=>push(s.getAttribute('src')));
    ['data-src','data-hls','data-mp4','data-webm','data-url'].forEach(a=>push(v.getAttribute(a)));
  });

  // direct links in anchors
  doc.querySelectorAll('a[href]').forEach(a=>{
    const href = a.getAttribute('href');
    if (/\.(mp4|webm|og[gv]|m3u8|mpd)(\?|#|$)/i.test(href)) push(href);
  });

  // common script tags that inline playlist urls (very heuristic)
  doc.querySelectorAll('script').forEach(s=>{
    const t = s.textContent || '';
    (t.match(/https?:\/\/[^\s'"]+\.(mp4|webm|og[gv]|m3u8|mpd)[^\s'"]*/gi)||[]).forEach(u=>push(u));
  });

  return uniq(urls);
}

function render(urls){
  resultsEl.innerHTML = '';
  let hlsSeen = false;
  if (!urls.length){
    noneEl.style.display = 'block';
    countsEl.textContent = '';
    hlsWarn.style.display = 'none';
    return;
  }
  noneEl.style.display = 'none';

  const summary = {mp4:0, webm:0, ogg:0, m3u8:0, mpd:0, other:0};
  urls.forEach(u=>{
    const meta = EXT_TYPE(u);
    if (meta.hls) { summary.m3u8++; hlsSeen = true; }
    else if (meta.dash) summary.mpd++;
    else if (meta.ext==='mp4') summary.mp4++;
    else if (meta.ext==='webm') summary.webm++;
    else if (meta.ext==='ogg') summary.ogg++;
    else summary.other++;

    const name = pickName(u);
    const item = document.createElement('div');
    item.className = 'item';
    item.innerHTML = `
      <strong>${name}</strong>
      <div class="tag">${meta.ext ? meta.ext.toUpperCase() : 'bilinmeyen tür'}</div>
      <div class="hint" style="margin:6px 0"><code>${u}</code></div>
      <div class="actions">
        <a class="dl" href="${u}" download="${name}" target="_blank" rel="noopener">
          <button>İndir</button>
        </a>
        <button class="copy" data-url="${u}">Kopyala</button>
      </div>
    `;
    resultsEl.appendChild(item);
  });

  countsEl.textContent = Bulunan bağlantılar → MP4:${summary.mp4} • WEBM:${summary.webm} • OGG:${summary.ogg} • HLS(M3U8):${summary.m3u8} • DASH(MPD):${summary.mpd} • Diğer:${summary.other};
  hlsWarn.style.display = hlsSeen ? 'block' : 'none';

  // copy handlers
  resultsEl.querySelectorAll('.copy').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(btn.dataset.url);
        btn.textContent = 'Kopyalandı';
        setTimeout(()=>btn.textContent='Kopyala', 1200);
      }catch(_){
        alert('Kopyalanamadı.');
      }
    });
  });
}

async function fetchAndParse(url){
  try{
    fetchBtn.disabled = true; fetchBtn.textContent = 'Taranıyor...';
    const res = await fetch(url, {mode:'cors'}); // çoğu sitede CORS engeli olabilir
    const html = await res.text();
    const doc = new DOMParser().parseFromString(html, 'text/html');
    const urls = collectFromDoc(doc);
    render(urls);
  }catch(err){
    alert('Alınamadı (CORS olabilir). HTML kaynağını yapıştırmayı deneyin.');
    console.error(err);
  }finally{
    fetchBtn.disabled = false; fetchBtn.textContent = 'URL’den Tara';
  }
}

parseBtn.addEventListener('click', ()=>{
  const html = htmlInput.value.trim();
  if(!html){ alert('Önce HTML yapıştır.'); return; }
  const doc = new DOMParser().parseFromString(html, 'text/html');
  render(collectFromDoc(doc));
});

fetchBtn.addEventListener('click', ()=>{
  const u = pageUrl.value.trim();
  if(!u){ alert('Önce bir URL yaz.'); return; }
  fetchAndParse(u);
});

clearBtn.addEventListener('click', ()=>{
  htmlInput.value = ''; resultsEl.innerHTML=''; noneEl.style.display='block'; countsEl.textContent=''; hlsWarn.style.display='none';
});

// Bookmarklet rehberi
bookmarkletBtn.addEventListener('click', ()=>{
  const code = `
    (function(){
      try{
        const urls = [];
        const push = u => { if(u && typeof u==='string'){ try{ urls.push(new URL(u, location.href).href); }catch{} } };
        document.querySelectorAll('video').forEach(v=>{
          push(v.getAttribute('src'));
          v.querySelectorAll('source').forEach(s=>push(s.getAttribute('src')));
          ['data-src','data-hls','data-mp4','data-webm','data-url'].forEach(a=>push(v.getAttribute(a)));
        });
        document.querySelectorAll('a[href]').forEach(a=>{
          const h=a.getAttribute('href');
          if(/\.(mp4|webm|og[gv]|m3u8|mpd)(\\?|#|$)/i.test(h)) push(h);
        });
        const u2 = Array.from(new Set(urls));
        if(!u2.length){ alert('Video bağlantısı bulunamadı.'); return; }
        const text = 'Bulunan bağlantılar:\\n\\n' + u2.join('\\n');
        const w = window.open('', '_blank', 'width=720,height=480');
        w.document.write('<pre style="white-space:pre-wrap;font:14px/1.5 ui-monospace,monospace;padding:16px">'+text.replace(/[&<>]/g,s=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[s]))+'</pre>');
      }catch(e){ alert('Hata: '+e); }
    })();
  `.replace(/\n\s+/g,' ');
  const href = 'javascript:' + encodeURIComponent(code);
  const help = `
    <p>Bu metni yer imlerine sürükle: <a href="${href}">▶ Video Bul (Bookmarklet)</a></p>
    <p>Sonra herhangi bir video sayfasındayken bu yer imine tıkla; sayfada bulunan video linklerini açılan pencerede göreceksin.</p>
  `;
  const w = window.open('', '_blank'); w.document.write(help);
});
</script>
</body>
</html>

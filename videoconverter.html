<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Süper Basit Video Bul & İndir</title>
<style>
  :root{--g:12px;--r:12px}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;background:#0f1115;color:#e9eef5}
  header{position:sticky;top:0;z-index:10;background:#0b0d12;border-bottom:1px solid #262b36;padding:16px}
  h1{margin:0 0 6px;font-size:18px}
  small{color:#9fb0c6}
  main{max-width:900px;margin:0 auto;padding:16px}
  .card{background:#121624;border:1px solid #283045;border-radius:var(--r);padding:14px;margin-bottom:var(--g)}
  label{display:block;margin:0 0 8px}
  textarea{width:100%;min-height:200px;background:#0c1019;color:#e9eef5;border:1px solid #2b3242;border-radius:10px;padding:12px;resize:vertical}
  button{width:100%;margin-top:8px;padding:12px;border:0;border-radius:10px;background:#2f6fed;color:#fff;font-weight:700;cursor:pointer}
  .hint{font-size:13px;color:#9fb0c6;margin-top:6px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:var(--g)}
  .item{background:#0d1320;border:1px solid #27324a;border-radius:12px;padding:12px}
  .item strong{display:block;margin-bottom:6px}
  code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;word-break:break-all}
  .tag{font-size:12px;color:#9fb0c6}
  .actions{display:flex;gap:8px;margin-top:10px}
  .copy{flex:1;background:#1f2533;border-radius:10px;padding:10px;font-weight:700;text-align:center}
  .dl{flex:1;text-decoration:none}
  .dl > button{width:100%}
  .warn{background:#201314;border:1px solid #5f2024;color:#ffb3b8;padding:8px 10px;border-radius:8px;font-size:13px;margin-top:10px}
</style>
</head>
<body>
<header>
  <h1>Süper Basit Video Bul & İndir</h1>
  <small>Yalnızca hak sahibi olduğun videoları indir. DRM/HLS/CORS kısıtları aşılmaz.</small>
</header>

<main>
  <div class="card">
    <label>Hedef sayfanın <b>kaynak HTML</b>’sini veya gömülü player HTML’sini buraya yapıştır</label>
    <textarea id="input" placeholder="Örn: &lt;video&gt;&lt;source src='https://.../dosya.mp4'&gt;&lt;/video&gt; ..."></textarea>
    <button id="scanBtn">Tara</button>
    <div class="hint">İpucu: Sayfada “Kaynak Görüntüle” (veya geliştirici araçları) ile HTML’yi kopyala → buraya yapıştır → Tara.</div>
  </div>

  <div class="card">
    <strong>Sonuçlar</strong>
    <div id="counts" class="hint" style="margin:6px 0 10px"></div>
    <div id="results" class="grid"></div>
    <div id="none" class="hint">Henüz bir şey bulunmadı.</div>
    <div id="hlsWarn" class="warn" style="display:none">Bazı bağlantılar <b>M3U8/HLS</b> veya <b>MPD/DASH</b> olabilir. Bunlar tek dosya değildir; mobil tarayıcıda doğrudan indirme genelde mümkün olmaz.</div>
  </div>

  <div class="card">
    <button id="fillDemo">Demo veri yükle (çalıştığını test et)</button>
  </div>
</main>

<script>
/* ——— Yardımcılar ——— */
const $ = s => document.querySelector(s);
const input = $('#input'), resultsEl = $('#results'), countsEl = $('#counts');
const noneEl = $('#none'), hlsWarn = $('#hlsWarn');

/* .mp4 .webm .ogg .m3u8 .mpd url’lerini ham metin içinde de bul */
const RX_URL = /(https?:\/\/[^\s"'<>]+?\.(?:mp4|webm|og(?:g|v)|m3u8|mpd))(?:[^\s"'<>]*)/ig;
const uniq = a => [...new Set(a)];
function extMeta(u){
  try{
    const p = new URL(u, location.href).pathname.toLowerCase();
    if(p.endsWith('.mp4'))  return {ext:'mp4'};
    if(p.endsWith('.webm')) return {ext:'webm'};
    if(p.endsWith('.ogg')||p.endsWith('.ogv')) return {ext:'ogg'};
    if(p.endsWith('.m3u8')) return {ext:'m3u8', hls:true};
    if(p.endsWith('.mpd'))  return {ext:'mpd', dash:true};
  }catch{}
  return {ext:''};
}
function fname(u){
  try{ const n=new URL(u, location.href).pathname.split('/').pop()||'video'; return n.split('?')[0]||'video'; }
  catch{ return 'video'; }
}

/* DOM’tan topla */
function fromDOM(html){
  const doc = new DOMParser().parseFromString(html, 'text/html');
  const out = [];
  const push = v => { if(!v) return; try{ out.push(new URL(v, doc.baseURI||location.href).href); }catch{} };

  doc.querySelectorAll('video').forEach(v=>{
    push(v.getAttribute('src'));
    v.querySelectorAll('source').forEach(s=>push(s.getAttribute('src')));
    ['data-src','data-hls','data-mp4','data-webm','data-url','data-file'].forEach(a=>push(v.getAttribute(a)));
  });
  doc.querySelectorAll('a[href]').forEach(a=>{
    const h=a.getAttribute('href');
    if(/\.(mp4|webm|og[gv]|m3u8|mpd)(\?|#|$)/i.test(h)) push(h);
  });
  doc.querySelectorAll('iframe[src]').forEach(i=>push(i.getAttribute('src'))); // bilgi amaçlı
  return uniq(out);
}

/* Metinden topla (script/JSON dahil) */
function fromText(text){
  const out=[]; let m; RX_URL.lastIndex=0; while((m=RX_URL.exec(text))!==null) out.push(m[1]);
  return uniq(out);
}

/* Sonuçları yaz */
function render(list){
  resultsEl.innerHTML=''; hlsWarn.style.display='none';
  if(!list.length){ noneEl.style.display='block'; countsEl.textContent=''; return; }
  noneEl.style.display='none';

  let s={mp4:0,webm:0,ogg:0,m3u8:0,mpd:0,other:0}, hasHLS=false;
  list.forEach(u=>{
    const m=extMeta(u);
    if(m.hls){ s.m3u8++; hasHLS=true; }
    else if(m.dash){ s.mpd++; }
    else if(m.ext==='mp4') s.mp4++;
    else if(m.ext==='webm') s.webm++;
    else if(m.ext==='ogg') s.ogg++;
    else s.other++;

    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `
      <strong>${fname(u)}</strong>
      <div class="tag">${m.ext ? m.ext.toUpperCase() : 'bilinmeyen/iframe'}</div>
      <div class="hint" style="margin:6px 0"><code>${u}</code></div>
      <div class="actions">
        <a class="dl" href="${u}" download="${fname(u)}"><button>İndir</button></a>
        <button class="copy" data-url="${u}">Kopyala</button>
      </div>`;
    resultsEl.appendChild(div);
  });

  countsEl.textContent = Toplam ${list.length} • MP4:${s.mp4} • WEBM:${s.webm} • OGG:${s.ogg} • HLS:${s.m3u8} • DASH:${s.mpd} • Diğer:${s.other};
  if(hasHLS) hlsWarn.style.display='block';

  resultsEl.querySelectorAll('.copy').forEach(b=>{
    b.onclick = async ()=>{
      try{ await navigator.clipboard.writeText(b.dataset.url);
        b.textContent='Kopyalandı'; setTimeout(()=>b.textContent='Kopyala',1200);
      }catch{ alert('Kopyalanamadı'); }
    };
  });
}

/* Olaylar */
document.getElementById('scanBtn').onclick = ()=>{
  const text = input.value.trim();
  if(!text){ alert('Önce HTML/metin yapıştır.'); return; }
  const urls = uniq([...fromDOM(text), ...fromText(text)]);
  render(urls);
};

/* Demo: </script> kırılmasın diye güvenli kaçış uygulanmıştır */
document.getElementById('fillDemo').onclick = ()=>{
  const demo = [
    '<video controls><source src="https://cdn.example.com/fragman-1080p.mp4"></video>',
    '<a href="https://files.example.com/clip.webm?x=1">indir</a>',
    // Aşağıdaki iki satır, dış <script> bloğunu bozmamak için kapanışı kaçırır:
    '<scr'+'ipt>const HLS_URL="https://v.example.com/abc/master.m3u8";</scr'+'ipt>',
    '<iframe src="https://player.example.com/embed/123"></iframe>'
  ].join('\n');
  input.value = demo;
  alert('Demo veri yüklendi. Şimdi "Tara"ya bas.');
};
</script>
</body>
</html>

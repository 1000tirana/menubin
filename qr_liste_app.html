<!doctype html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Lista QR Â· 4 Shifrat e Fundit</title>
<style>
  :root{
    --bg:#0f1115;
    --card:#171a21;
    --muted:#a9b1c3;
    --text:#e7ebf5;
    --accent:#29c06f;
    --danger:#ff5d5d;
    --warn:#ffc53d;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
  }
  header{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,0));
    padding:10px 16px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .flags{display:flex; gap:8px;}
  .flags button{background:none;border:none;font-size:20px;cursor:pointer}
  .app-title{font-size:16px;font-weight:700}
  .pill{padding:4px 10px;border-radius:999px;background:#1f2430;color:var(--muted);font-size:12px;}
  .last-scan{
    position:sticky; top:46px; z-index:15;
    display:flex; align-items:center; gap:8px;
    background:#122019; color:#bff4d1;
    border:1px solid #1b3a2b; border-left:4px solid var(--accent);
    margin:6px 12px; border-radius:10px; padding:8px 12px;
    font-size:14px;
  }
  .last-scan.duplicate{background:#2b1515;color:#f8c6c6;border-color:var(--danger)}
  .container{padding:10px 16px 120px 16px; max-width:840px; margin:0 auto;}
  .camera-card{background:var(--card);border-radius:14px;padding:12px;}
  .video-wrap{position:relative;border-radius:12px;overflow:hidden;background:#0a0c10;aspect-ratio:3/4;}
  video{width:100%;height:100%;object-fit:cover;display:block;}
  canvas#capture{display:none;}
  .scan-frame{position:absolute;inset:10%;border:2px solid rgba(255,255,255,.75);border-radius:12px;pointer-events:none;}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
  button,.btn{appearance:none;border:none;border-radius:12px;background:#222734;color:var(--text);padding:10px 14px;font-size:14px;font-weight:600;cursor:pointer}
  button:disabled{opacity:.5;cursor:not-allowed}
  .btn-primary{background:var(--accent);color:#07130e}
  .btn-danger{background:var(--danger);color:#260000}
  .btn-warn{background:var(--warn);color:#221a00}
  .list-card{margin-top:16px;background:var(--card);border-radius:14px;padding:8px 0;}
  .list-header{display:flex;justify-content:space-between;align-items:center;padding:8px 14px;border-bottom:1px solid #242a39;}
  .list{list-style:none;padding:0;margin:0;}
  .item{display:flex;gap:10px;align-items:flex-start;padding:12px 14px;border-bottom:1px dashed #23293a;}
  .item:last-child{border-bottom:none}
  .index{width:28px;height:28px;border-radius:999px;background:#242a39;display:flex;align-items:center;justify-content:center;font-weight:700;color:#c0c7d9;flex:0 0 auto;}
  .value{flex:1;font-size:18px;font-weight:700;letter-spacing:.5px}
  .time{color:var(--muted);font-size:12px;margin-top:4px}
  .del-btn{background:#23293a;color:#ff9b9b;border-radius:10px;padding:4px 8px}
  .toolbar{position:fixed;left:0;right:0;bottom:0;z-index:10;backdrop-filter:blur(10px);background:rgba(10,12,16,.8);border-top:1px solid #242a39;padding:10px 16px;display:flex;gap:10px;}
  .toolbar .btn{flex:1;justify-content:center}
  .toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#161d2a;color:#e7f1ff;padding:8px 12px;border-radius:10px;border:1px solid #27324a;display:none;}
</style>
</head>
<body>
<header>
  <div><span class="app-title" id="t-title">Lista QR</span> <span id="camStatus" class="pill">Kamera: Mbyllur</span></div>
  <div class="flags">
    <button onclick="setLang('sq')">ðŸ‡¦ðŸ‡±</button>
    <button onclick="setLang('en')">ðŸ‡¬ðŸ‡§</button>
    <button onclick="setLang('tr')">ðŸ‡¹ðŸ‡·</button>
  </div>
</header>

<div id="lastBanner" class="last-scan" style="display:none;">
  <strong id="t-last">I fundit:</strong> <span id="lastValue">â€”</span>
</div>

<div class="container">
  <div class="camera-card">
    <div class="video-wrap">
      <video id="video" playsinline muted></video>
      <div id="scanFrame" class="scan-frame"></div>
    </div>
    <div class="controls">
      <button id="startBtn" class="btn-primary">Start</button>
      <button id="stopBtn" class="btn">Stop</button>
      <button id="resetBtn" class="btn-danger">Pastro</button>
    </div>
  </div>

  <div class="list-card">
    <div class="list-header">
      <div><strong id="t-list">Lista</strong> Â· <span id="count">0</span></div>
    </div>
    <ul id="list" class="list"></ul>
  </div>
</div>

<div class="toolbar">
  <button id="copyBtn" class="btn">Kopjo</button>
  <button id="waBtn" class="btn">WhatsApp</button>
</div>

<canvas id="capture"></canvas>
<div id="toast" class="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
<script>
const video=document.getElementById('video'),canvas=document.getElementById('capture'),ctx=canvas.getContext('2d',{willReadFrequently:true});
const startBtn=document.getElementById('startBtn'),stopBtn=document.getElementById('stopBtn'),resetBtn=document.getElementById('resetBtn');
const listEl=document.getElementById('list'),countEl=document.getElementById('count'),lastBanner=document.getElementById('lastBanner'),lastValue=document.getElementById('lastValue');
const copyBtn=document.getElementById('copyBtn'),waBtn=document.getElementById('waBtn'),camStatus=document.getElementById('camStatus'),toastEl=document.getElementById('toast');
let stream=null,scanning=false,lastScanAt=0,detectedSet=new Set(),items=[];

function last4(s){const only=String(s).replace(/[^0-9A-Za-z]/g,'');return only.slice(-4).toUpperCase();}
function beep(){try{const ac=new (window.AudioContext||window.webkitAudioContext)();const o=ac.createOscillator();const g=ac.createGain();o.type='triangle';o.frequency.value=880;o.connect(g);g.connect(ac.destination);g.gain.setValueAtTime(0.001,ac.currentTime);g.gain.exponentialRampToValueAtTime(0.2,ac.currentTime+0.02);g.gain.exponentialRampToValueAtTime(0.001,ac.currentTime+0.15);o.start();o.stop(ac.currentTime+0.16);setTimeout(()=>ac.close(),250);}catch{}}
function addItem(raw){const val=last4(raw);if(!val)return;const now=new Date();if(detectedSet.has(raw)){lastBanner.classList.add('duplicate');}else{detectedSet.add(raw);items.push({value:val,time:now});renderList();beep();lastBanner.classList.remove('duplicate');}lastValue.textContent=val;lastBanner.style.display='flex';save();}
function renderList(){listEl.innerHTML='';items.forEach((it,idx)=>{const li=document.createElement('li');li.className='item';li.innerHTML=`<div class="index">${idx+1}</div><div class="value">${it.value}</div><div class="time">${it.time.toLocaleTimeString()}</div><button class="del-btn">Ã—</button>`;li.querySelector('.del-btn').onclick=()=>{items.splice(idx,1);renderList();save();};listEl.appendChild(li);});countEl.textContent=items.length;}
async function startCam(){try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});video.srcObject=stream;await video.play();scanning=true;scanLoop();camStatus.textContent=langs[curLang].camOn;}catch(e){alert(e);}}
function stopCam(){scanning=false;if(stream){stream.getTracks().forEach(t=>t.stop());}video.srcObject=null;camStatus.textContent=langs[curLang].camOff;}
async function scanLoop(){if(!scanning)return;const now=performance.now();if(now-lastScanAt<150){return requestAnimationFrame(scanLoop);}lastScanAt=now;if(video.readyState>=2){canvas.width=video.videoWidth;canvas.height=video.videoHeight;ctx.drawImage(video,0,0,canvas.width,canvas.height);const img=ctx.getImageData(0,0,canvas.width,canvas.height);const qr=jsQR(img.data,canvas.width,canvas.height);if(qr&&qr.data){addItem(qr.data.trim());}}requestAnimationFrame(scanLoop);}
function copyAll(){const t=items.map((x,i)=>`${i+1}. ${x.value}`).join("\\n");navigator.clipboard.writeText(t);showToast(langs[curLang].copied);}
function whatsapp(){const t=items.map((x,i)=>`${i+1}. ${x.value}`).join("\\n");window.open("https://wa.me/?text="+encodeURIComponent(t));}
function save(){localStorage.setItem("qrItems",JSON.stringify(items));}
function load(){const r=localStorage.getItem("qrItems");if(r){items=JSON.parse(r);items=items.map(o=>({value:o.value,time:new Date(o.time)}));renderList();}}
function showToast(m){toastEl.textContent=m;toastEl.style.display='block';setTimeout(()=>toastEl.style.display='none',1500);}

// language support
const langs={
 sq:{title:"Lista QR",camOn:"Kamera: Hap",camOff:"Kamera: Mbyllur",list:"Lista",last:"I fundit:",copied:"Kopjuar!"},
 en:{title:"QR List",camOn:"Camera: On",camOff:"Camera: Off",list:"List",last:"Last:",copied:"Copied!"},
 tr:{title:"QR Liste",camOn:"Kamera: AÃ§Ä±k",camOff:"Kamera: KapalÄ±",list:"Liste",last:"Son:",copied:"KopyalandÄ±!"}
};
let curLang="sq";
function setLang(l){curLang=l;document.getElementById('t-title').textContent=langs[l].title;document.getElementById('t-list').textContent=langs[l].list;document.getElementById('t-last').textContent=langs[l].last;camStatus.textContent=scanning?langs[l].camOn:langs[l].camOff;copyBtn.textContent=l=="tr"?"Kopyala":l=="en"?"Copy":"Kopjo";waBtn.textContent="WhatsApp";resetBtn.textContent=l=="tr"?"Temizle":l=="en"?"Clear":"Pastro";startBtn.textContent=l=="tr"?"BaÅŸlat":l=="en"?"Start":"Start";stopBtn.textContent=l=="tr"?"Durdur":l=="en"?"Stop":"Stop";}
window.setLang=setLang;

// events
startBtn.onclick=startCam;stopBtn.onclick=stopCam;resetBtn.onclick=()=>{items=[];detectedSet.clear();renderList();save();};copyBtn.onclick=copyAll;waBtn.onclick=whatsapp;

// init
load();setLang("sq");
</script>
</body>
</html>
